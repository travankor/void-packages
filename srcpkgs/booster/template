# Template file for 'booster'
pkgname=booster
version=0.5
revision=1
build_style=go
go_import_path=github.com/anatol/booster
go_package="${go_import_path}/generator ${go_import_path}/init"
hostmakedepends="git ruby-ronn"
depends="busybox-static"
short_desc="Fast and secure initramfs generator"
maintainer="travankor <travankor@tuta.io>"
license="MIT"
homepage="https://github.com/anatol/booster"
distfiles="https://github.com/anatol/booster/archive/${version}.tar.gz"
checksum=aea7e30cad1987bcc61de0c18b4273b477782c57a331ca47d92d0146860529b0
conf_files="/etc/booster.yaml"

pre_build() {
	export CGO_ENABLED=0
}

do_install() {
	if [ "$CROSS_BUILD" ]; then
		vbin ${GOPATH}/bin/linux_${GOARCH}/generator booster
		vinstall ${GOPATH}/bin/linux_${GOARCH}/init 755 usr/lib/booster
	else
		vbin ${GOPATH}/bin/generator booster
		vinstall ${GOPATH}/bin/init 755 usr/lib/booster
	fi
	ronn docs/manpage.md
	vman docs/manpage.1 booster.1
	echo "busybox: true" > booster.yaml
}

post_install() {
	vconf booster.yaml
	vinstall ${FILESDIR}/kernel-hook-postinst 755 etc/kernel.d/post-install 20-booster
	vinstall ${FILESDIR}/kernel-hook-postrm 755 etc/kernel.d/post-remove 20-booster
	vlicense LICENSE
}
